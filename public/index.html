<!DOCTYPE html>
<head>
    <link href="./css/tachyons.min.css" type="text/css" rel="stylesheet">
    <link href="./css/jexcel.css" type="text/css" rel="stylesheet">
    <link href="./css/jsuites.css" type="text/css" rel="stylesheet">
    <script src="./js/jexcel.js"></script>
    <script src="./js/jsuites.js"></script>
</head>
<body>
    <div id="spreadsheet"></div>
    <style>
        #ROOT {
            background-color: khaki;
        }
    </style>
        <script>

            // var columns = [
            //         // { type: 'text', title:'name', width:120 },
            //         // { type: 'dropdown', title:'Concentric Type', width:200, source:[ "Push", "Pull", "Squat", "Hinge" ] },
            //         // { type: 'dropdown', title:'Area', width:200, source:[ "Upper", "Lower", "Full" ] },
            //         // { type: 'dropdown', title: 'Symmetry', width: 200, source: ["Bilateral", "Unilateral"]},
            //         // { type: 'number', title: 'id', readonly: true },
            //         // { type: 'dropdown', title: 'Plane', width: 200, source: ["Horizontal", "Vertical", "Lateral"]},
            //         // { type: 'text', title: 'Description', width: 200}
            //     ]

            var columns = []
            var load_all_movements = function(instance, cell, col, row, value) {
                var xhttp = new XMLHttpRequest();
                xhttp.onreadystatechange = function() {
                    if (this.readyState == 4 && this.status == 200) {
                        // Action to be performed when the document is read;
                        var obj_response = JSON.parse(this.response)
                        var movements = jexcel(document.getElementById('spreadsheet'), {
                            data: obj_response.data,
                            fullscreen: true,
                            search:true,
                            onchange: changed,
                            columns: obj_response.columns
                        });
                        
                        obj_response.columns.forEach(function(column, index) {
                            if (column.title == 'id' || column.title == 'kind') {
                                movements.hideColumn(index);
                            }
                        })
                        // obj_response.columns.forEach(function(column, index) {
                        //     instance.jexcel.insertColumn(1, index, false, column)
                        // })

                        // obj_response.all_movements.forEach(function(movement,index) {
                        //     console.log(movement, index)
                        //     var vals = Object.values(movement)
                        //     console.log(vals)
                        //     // instance.jexcel.setRowData(index, vals)
                        //     vals.forEach(function(movement_attr, attr_index) {
                        //         instance.jexcel.setValue(attr_index, movement_attr)
                        //     })
                        // })

                    }
                };
                xhttp.open("GET", "/read_all_movements.json", true);
                xhttp.send(); 
            }

            var changed = function(instance, cell, col, row, value) {

                var http = new XMLHttpRequest();
                var url = "/save_movements.json"
                http.open('POST', url);
                http.setRequestHeader('Content-Type', 'application/json');

                // console.log(instance.jexcel.options.meta)
                var row_data = instance.jexcel.getRowData(row);
                console.log(row_data)
                console.log(instance)
                var existing;

                // instance.options.columns.forEach(function(column, index) {
                //     if (column.title == "kind") {
                //         existing = row_data[index]
                //     }
                // })

                console.log(existing);

                // http.send(JSON.stringify(to_json))
            }

        load_all_movements()

        </script>
</body>
</html>